"use strict";const newrelic=require("newrelic"),express=require("express"),path=require("path"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),enps=require("./routes/enpsapi"),favicon=require("serve-favicon"),middleware=require("./middleware"),config=require("./config"),test=require("./test"),index=require("./routes/index");var io=require("socket.io"),app=express();app.use(favicon(path.join(__dirname,"public","images","favicon.ico"))),app.set("views",path.join(__dirname,"views")),app.set("view engine","ejs"),app.engine("html",require("ejs").renderFile),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(express.static(path.join(__dirname,"public"))),app.use("/api/v1/",enps),app.use("/",index),app.use(middleware.expresslogger),app.use(function(e,r,i){return middleware.logger.error({"Main Error Handling":e.statusCode,originalUrl:e.originalUrl}),500===i.statusCode?"Error 500":404===i.statusCode?e:void 0});var server=app.listen(3e3,function(){var e=server.address().port;middleware.logger.info("Running on http://localhost:",e)}),listener=io.listen(server);listener.sockets.on("connection",function(e){e.emit("message",{message:"Connected to App"})}),listener.sockets.on("error",function(e){return middleware.logger.info("error event in socket.send(): "+e)}),process.on("SIGINT",function(){middleware.logger.info("SIGINT Received .. shutting down"),process.exit(0)}),module.exports=app;