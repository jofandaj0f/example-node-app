var request=require("request"),logger=require("./logger"),enps={logon:function(e,t,n,r,o){var s={method:"GET",url:e+"/api/Logon",qs:{staffUserId:t,domainuserId:"enpsapi",password:n,domainName:r,devKey:o,iClientType:"7"},headers:{"Cache-Control":"no-cache"}};return new Promise(function(e,t){request.get(s,function(n,r,o){n?t(n):e(JSON.parse(o))})})},ping:function(e,t){request({method:"GET",url:e+"/api/Ping",headers:{"Cache-Control":"no-cache","X-ENPS-TOKEN":t}},function(e,t,n){if(e)throw new Error(e);console.log(n)})},search:function(e,t,n,r){logger.info("enps.js search: ",e,t,n,r);var o={method:"POST",url:e+"/api/Search",headers:{"Content-Type":"application/json","X-ENPS-TOKEN":t},body:{Database:n,MaxRows:200,ExactMatch:!1,NOMContentTypes:{All:!1,Audio:!1,Contacts:!1,Grids:!1,Messages:!1,NewsgatheringGrids:!1,NewsgatheringItems:!1,Pictures:!1,Readins:!1,Rundowns:!0,Scripts:!1,Storyboards:!1,Video:!1},NOMContentDates:{All:!0,CustomDateRange:!1,FortyEightHours:!1,ItemDateFrom:"2018-10-02T00:00:01.000Z",ItemDateTo:"2018-10-02T23:59:00.000Z",Future:!1,OneHour:!1,OneWeek:!1,TwentyFourHours:!1,TwoHours:!1},NOMLocations:[{BasePath:r,SearchArchives:!1,SearchTrash:!1,SearchWIP:!0}]},json:!0};return new Promise(function(e,t){request.post(o,function(n,r,o){if(n)t(n);else{var s=[];if(void 0===o.SearchResults||null===o.SearchResults||0===o.SearchResults.length)e(s);else for(var a=0;a<o.SearchResults.length;a++){var i=o.SearchResults[a];if(i.ObjectProperties[10].FieldValue){var u={database:i.ListData.ENPSDatabase,path:i.ListData.Path,guid:i.ListData.Guid,returnText:!1};s.push(u)}}e(s)}})})},getMultiplePlanningContent:function(e,t,n){var r={method:"POST",url:e+"/api/RundownContent",headers:{"Content-Type":"application/json","X-ENPS-TOKEN":t},body:n,json:!0};return new Promise(function(e,t){request.post(r,function(n,r,o){n?t(n):e(o)})})}};module.exports=enps;