function download_csv(e,i,t){var o="",n="";"grid"==t&&(o+="Story Slug,Event Time,Location,Zone,Type,Status,Reporter,Crew,V R X,Path,GUID\n",$.each(JSON.parse(e),function(e,i){if("PHOTOGS LI"!=i.slug&&"PHOTOGS NJ"!=i.slug&&"PHOTOGS HV"!=i.slug&&"AJ TRUCK OP 930"!=i.slug&&"FUTURES"!=i.slug||console.log("Skipping Header..."),"ALL ZONES"!=i.slug&&"LONG ISLAND"!=i.slug&&"NEW JERSEY"!=i.slug&&"HUDSON VALLEY"!=i.slug||(n=i.slug),void 0===i.reporter[0]&&void 0===i.crew[0]&&console.log("No assigned field staff..."),void 0!==i.reporter[0]&&void 0!==i.crew[0]){if(void 0!==i.slug){var t="",s=i.slug.replace(/,/g,"");o+=s+","}else void 0===i.slug&&(o+=",");if(o+=i.eventTime+",",o+=i.location+",",o+=n+",",o+=i.type+",",o+=i.status+",",void 0!==i.reporter[0]){var l=i.reporter[0].length;o+=i.reporter[0].substring(17,l)+",",t+="R"}else void 0===i.reporter[0]&&(o+=",");if(o+=",",o+=t+",",o+=i.path+",",o+=i.guid+",",o+="\n",void 0!==i.slug){var t="",s=i.slug.replace(/,/g,"");o+=s+","}else void 0===i.slug&&(o+=",");if(o+=i.eventTime+",",o+=i.location+",",o+=n+",",o+=i.type+",",o+=i.status+",",o+=",",void 0!==i.crew[0]){var d=i.crew[0].length;o+=i.crew[0].substring(6,d)+",",t+="V"}else void 0===i.crew[0]&&(o+=",");o+=t+",",o+=i.path+",",o+=i.guid+",",o+="\n"}else{if(void 0!==i.slug){var t="",s=i.slug.replace(/,/g,"");o+=s+","}else void 0===i.slug&&(o+=",");if(o+=i.eventTime+",",o+=i.location+",",o+=n+",",o+=i.type+",",o+=i.status+",",void 0!==i.reporter[0]){var l=i.reporter[0].length;o+=i.reporter[0].substring(17,l)+",",t+="R"}else void 0===i.reporter[0]&&(o+=",");if(void 0!==i.crew[0]){var d=i.crew[0].length;o+=i.crew[0].substring(6,d)+",",t+="V"}else void 0===i.crew[0]&&(o+=",");o+=t+",",o+=i.path+",",o+=i.guid+",",o+="\n"}})),"RO"==t&&(o+="Page,Story Slug,Segment,Xpression,MOS ID,Front,Back,LastModBy,Estimated Duration,Float,Path,GUID\n",$.each(e,function(e,i){if(o+=i.PageNum+",",void 0!==i.Title){var t=i.Title.indexOf("-")+1,n=i.Title.length,s=i.Title.replace(/,/g,"");o+=s.substring(0,i.Title.indexOf("-"))+",",o+=i.Title.substring(t,n)+","}else void 0===i.Title&&(o+=",",o+=",");if(void 0!==i.WRNNXpressionMOS){for(var l="",d=0;i.WRNNXpressionMOS.length&&void 0!==i.WRNNXpressionMOS[d];d++){console.log(i.WRNNXpressionMOS[d],d,void 0);var r=i.WRNNXpressionMOS[d].indexOf(":")+1;l+=i.WRNNXpressionMOS[d].substring(r,i.WRNNXpressionMOS[d].length).replace(/,/g,"")+" "}o+=l+","}else void 0===i.WRNNXpressionMOS&&(o+=",");void 0!==i.WRNNCrispNew[0]?o+=i.WRNNCrispNew[0]+",":o+=",",o+=i.FrontTime+",",o+=i.BackTime+",",void 0!==i.RowModBy?o+=i.RowModBy+",":o+=",",void 0!==i.Estimated?o+=i.Estimated+",":o+=",",o+=i.Float+",",o+=i.Path+",",o+=i.GUID+",",o+="\n"})),console.log("Done Parsing Grid"),console.log("Downloading CSV file now...");var s=document.createElement("a");s.href="data:text/csv;charset=utf-8,"+encodeURI(o),s.target="_blank",s.download=i,s.click(),$(".lds-ellipsis").remove()}$(document).on("click","#listRundowns",function(){console.log("Grabbing Rundowns");var e=$("#theDate").val().toString(),i=$("#zones").val().toString();8!==e.length?alert("Select Date!"):($("#loader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({url:"/api/v1/enps/listRundowns",type:"POST",datatype:"json",contentType:"application/json",data:JSON.stringify({date:e,enpsFolder:i})}).done(function(e){$("#rundowns > option").remove(),$.each(e,function(e,i){var t=new Option(i.title,i.guid);$(t).html(i.title),$("#rundowns").append(t),$(".selectpicker").selectpicker("refresh")}),$(".lds-ellipsis").remove()}))}),$(document).on("click","#submit-grid",function(){var e=$("#theDate").val().toString();8!==e.length?alert("Select Date!"):($("#loader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({url:"/api/v1/enps/writeGridtoFile",type:"POST",datatype:"json",contentType:"application/json",data:JSON.stringify({date:e})}).done(function(e){download_csv(e,"Fios1News_Planning_Grid_20"+$("#theDate").val()+".csv","grid")}))}),$(document).on("click","#download-ro",function(){8!==$("#theDate").val().toString().length?alert("Select Date!"):($("#loader").append('<div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>'),$.ajax({url:"/api/v1/enps/writeROtoFile",type:"POST",datatype:"json",contentType:"application/json",data:JSON.stringify({guid:$("#rundowns").val(),enpsFolder:$("#zones").val()})}).done(function(e){console.log(e[0]),download_csv(e,"Fios1News_"+$("body > div > main > div:nth-child(7) > div:nth-child(2) > div > div > button").attr("title")+"_20"+$("#theDate").val()+".csv","RO")}))}),$(document).ready(function(){$("select").selectpicker()});